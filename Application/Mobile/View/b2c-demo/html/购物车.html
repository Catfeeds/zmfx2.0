
<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="apple-mobile-web-app-capable" content="no" />
    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="../media/favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" type="text/css" href="../css/style-index.css" />
    <link rel="stylesheet" type="text/css" href="../css/style-animate.css" />
    <link rel="stylesheet" type="text/css" href="../css/style-swiper.css" /> <!-- tab -->
    <link rel="stylesheet" type="text/css" href="../css/style-mobileSelect.css" /> <!-- ios下弹式菜单选择 -->
    <link rel="stylesheet" type="text/css" href="../css/style-layer.css" /> <!-- 提示 -->

    <script src="../js/jquery-1.12.3.js"></script>
    <script src="../js/swiper.min.js"></script> <!-- tab -->
    <script src="../js/mobileSelect.js"></script> <!-- ios下弹式菜单选择 -->
    <script src="../js/layer.js"></script> <!-- 提示 -->
</head>


<body>
    <section class="cart">

        <!-- top -->
        <header>
            <div class="web-top">
                <div class="back-box">
                    <img src="../img/back_icon.png" onclick="history.back(-1)" class="back-img" alt="">
                </div>
                <h2>购物车</h2>
                <div class="web-top-right">
                    <span class="cart-edit">编辑</span>
                </div>
            </div>
        </header>
        <!-- top end -->

        <section class="cart-list wrapper">

            <!-- 祼钻 -->
            <div class="goods-item luozhuan-item">
                <div class="head"><input type="checkbox" class="zdy-checkbox" name="" value=""> 【彩钻】编号:FME788213</div>
                <div class="goods-layout clearfix">
                    <div class="goods-right">
                        <h2>
                            形状：圆形    重量：0.5ct    颜色：M    净度：SI2
                            切工：VG      抛光：VG       对称：EX
                        </h2>
                        <p class="goods-title">GIA 6262205579</p>
                        <div class="goods-fangshi clearfix">
                            <span class="fl c9 rmb">￥<span class="price">5.00</span></span>
                            <span class="fr">
                                <div class="customize-box">
                                    <a href="javascript:;" class="reduction"><img src="../img/reduction_icon.png" alt=""></a>
                                    <input type="text" name="" onkeyup="value=value.replace(/[^\d]/g,'')" value="1" min="1" class="number-cust">
                                    <a href="javascript:;" class="add"><img src="../img/add_icon.png" alt=""></a>
                                    <div class="clearfix"></div>
                                </div>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 祼钻 end -->

            <!-- 匹配 -->
            <div class="goods-item">
                <div class="head"><input type="checkbox" class="zdy-checkbox" name="" value="">【定制】编号：2017073102247268977</div>
                <div class="goods-layout mb0 border-bottom clearfix">
                    <div class="goods-img">
                        <a href="商品详情.html"><img src="../img/goods_layou_img_03.jpg" alt=""></a>
                    </div>
                    <div class="goods-right">
                        <h2><a href="商品详情.html">玫瑰系列钻石戒指 经典</a></h2>
                        <p class="goods-title">颜色:18k白金+GIA+纯度99%</p>
                        <div class="goods-fangshi clearfix">
                            <span class="fl c9 rmb">￥<span class="price">5.00</span></span>
                        </div>
                    </div>
                </div>
                <!-- 祼钻 -->
                <div class="luozhuan-item pipei-goods">
                    <div class="head">【彩钻】编号:FME788213</div>
                    <div class="goods-layout clearfix">
                        <div class="goods-right">
                            <h2>
                                形状：圆形    重量：0.5ct    颜色：M    净度：SI2
                                切工：VG      抛光：VG       对称：EX
                            </h2>
                            <p class="goods-title">GIA 6262205579</p>
                            <div class="goods-fangshi clearfix">
                                <span class="fl c9 rmb">￥<span class="pipei-price">5.00</span></span>
                                <span class="fr">
                                    <div class="customize-box">
                                        <a href="javascript:;" class="reduction"><img src="../img/reduction_icon.png" alt=""></a>
                                        <input type="text" name="" onkeyup="value=value.replace(/[^\d]/g,'')" value="1" min="1" class="number-cust">
                                        <a href="javascript:;" class="add"><img src="../img/add_icon.png" alt=""></a>
                                        <div class="clearfix"></div>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 祼钻 end -->
            </div>
            <!-- 匹配 end -->

            <!-- 定制 -->
            <div class="goods-item">
                <div class="head"><input type="checkbox" class="zdy-checkbox" name="" value="">【定制】编号：2017073102247268977</div>
                <div class="goods-layout clearfix">
                    <div class="goods-img">
                        <a href="商品详情.html"><img src="../img/goods_layou_img_03.jpg" alt=""></a>
                    </div>
                    <div class="goods-right">
                        <h2><a href="商品详情.html">玫瑰系列钻石戒指 经典</a></h2>
                        <p class="goods-title">颜色:18k白金+GIA+纯度99%</p>
                        <div class="goods-fangshi clearfix">
                            <span class="fl c9 rmb">￥<span class="price">5.00</span></span>
                            <span class="fr">
                                <div class="customize-box">
                                    <a href="javascript:;" class="reduction"><img src="../img/reduction_icon.png" alt=""></a>
                                    <input type="text" name="" value="1" onkeyup="value=value.replace(/[^\d]/g,'')" min="1" class="number-cust">
                                    <a href="javascript:;" class="add"><img src="../img/add_icon.png" alt=""></a>
                                    <div class="clearfix"></div>
                                </div>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 定制 end -->

            <!-- 空购物车 -->
            <div class="empty-cart" style="display: none;">
                <p><img src="../img/empty_cart.png" alt="" class="empty-img"></p>
                <p>
                    <h2>您的购物车空空如也~~</h2>
                </p>
                <p><a href="/" class="toindex">去首页</a></p>
            </div>
            <!-- 空购物车 end -->

            <!-- 结算 -->
            <style>
                body { margin-bottom: 4.8rem !important;}
            </style>
            <div class="settlement">
                <input type="checkbox" id="check-all" class="zdy-checkbox" name="" value="">
                <label for="check-all" class="mr">全选</label> <span class="rmb total-box">合计:￥<span class="total-price">0.00</span></span>
                <a href="购物车-确认订单.html" class="set-btn" id="settlement-btn">去结算(<span class="sum">0</span>)</a>
                <a href="#" class="set-btn" id="removeData" style="display: none;">删除(<span class="sum">0</span>)</a>
            </div>
            <!-- 结算 end -->
        </section>
        <script>
            $(function(){
                /*
                 * @author: songjingwen;
                 * @date: 2017-8-1;
                 * 实现购物车交互功能：
                 * 1.全选、反选计算改变商品数量和价格
                 * 2.单选计算改变商品数量和价格
                 * 3.监听删除商品后改变商品数量
                 * 4.监听单个商品改变数量后计算改变商品数量和价格
                 * 5.监听商品状态
                 */

                var cart = {
                    //计算价格
                    price: function(){
                        var price = 0;
                        $('.goods-item').each(function(){
                            if($(this).find('.zdy-checkbox').prop('checked')){
                                var cust = $(this).find('.number-cust').val();
                                var pipei = Number($(this).find('.luozhuan-item').find('.pipei-price').html());
                                price = price + Number($(this).find('.price').html() * cust);
                                pipei ? price = price + (pipei * cust) : ''; //如果为匹配商品就加上匹配到商品的价格
                            }
                        });
                        $('.total-price').html(price);
                    },
                    //计算商品数量
                    goodsNumber: function(){
                        var lengths = 0;
                        $('.goods-item').each(function(){
                            if($(this).find('.zdy-checkbox').prop('checked')){
                                lengths = lengths + Number($(this).find('.number-cust').val());
                            }
                        });
                        $('.sum').html(lengths);

                        //如果商品全不选后改变全选按钮为取消状态
                        if(lengths == 0){
                            reset.checkboxAllFalse();
                        }

                        //5.监听商品状态：商品全部被选择后联动全选按钮
                        var len = $('.goods-item').length;
                        if(len == lengths){
                            $('#check-all').prop('checked', true);
                            reset.checkbox('#check-all');
                        }
                    },
                    //删除购物车商品
                    removeGoods: function(){
                        var sum = 0;
                        //获取选择商品数量
                        $('.goods-item').each(function(){
                            if($(this).find('.zdy-checkbox').prop('checked')){
                                sum = sum + Number($(this).find('.number-cust').val());
                            }
                        });
                        if(sum >= 1){
                            layer.open({
                                content: '确定要删除这'+ sum +'件宝贝吗？'
                                ,btn: ['确定', '取消']
                                ,yes: function(index){
                                    //删除商品
                                    $('.goods-item').each(function(){
                                        if($(this).find('.zdy-checkbox').prop('checked')){
                                            $(this).remove();
                                            cart.goodsNumber();

                                            //判断购物车是否有商品，没有则显示购物车为空
                                            if($('.goods-item').length <= 0){
                                                $('.empty-cart').show();
                                                $('.settlement').hide();
                                                cart.editCart();
                                            }else {
                                                $('.settlement').show();
                                                $('.empty-cart').hide();
                                            }
                                        }
                                    });
                                    layer.close(index);
                                }
                            });
                        }else{
                            layer.open({
                                content: '请选择商品'
                                ,btn: ['确定']
                            });
                        }
                    },
                    //编辑购物车
                    editCart: function(){
                        if($('.cart-edit').attr('data') == 'edit'){
                            reset.checkboxAll();//设置全选
                            $('.cart-edit').html('编辑');
                            $('.cart-edit').attr('data', '');
                            $('#settlement-btn, .total-box').show();
                            $('#removeData').hide();
                        }else{
                            reset.checkboxAllFalse();//设置全不选
                            $('.cart-edit').html('完成');
                            $('.cart-edit').attr('data', 'edit');
                            $('#settlement-btn, .total-box').hide();
                            $('#removeData').show();
                        }
                    }
                }

                //1.全选、反选计算改变商品数量和价格
                $(document).delegate('#check-all', 'change', function(){
                    cart.goodsNumber();
                    cart.price();
                });

                //2.单选计算改变商品数量和价格
                $('.goods-item').each(function(){
                    $(this).find('.zdy-checkbox').change(function(){
                        //5.监听商品状态：全选情况下如果有某个商品取消选择则联动全选按钮为取消状态
                        if(!$(this).find('.zdy-checkbox').prop('checked')){
                            $('#check-all').prop('checked', false);
                            reset.checkbox('#check-all');
                        }
                        cart.goodsNumber();
                        cart.price();
                    });
                });

                //3.删除商品后改变商品数量
                $('#removeData').bind('click', function(){
                    cart.removeGoods();
                });

                /*
                 * 商品数量选择
                 * 4.单个商品改变数量后计算改变商品数量和价格
                 */
                $('.customize-box').each(function(){
                    var str = $(this).find('.number-cust');
                    //加
                    $(this).find('.add').bind('click', function(){
                        str.val( Number(str.val())+1 );
                        cart.goodsNumber();
                        cart.price();
                    });
                    //减
                    $(this).find('.reduction').bind('click', function(){
                        if(str.val() > 1){
                            str.val( Number(str.val())-1 );
                            cart.goodsNumber();
                            cart.price();
                        }
                    });

                    //监听单件商品数量变化
                    $(this).find('.number-cust').on('input propertychange',function(){
                        cart.goodsNumber();
                        cart.price();
                    }).blur(function(){
                        if($(this).val() == ''){
                            $(this).val(1);
                            cart.goodsNumber();
                            cart.price();
                        }
                    });
                });

                //编辑购物车按钮
                $('.cart-edit').bind('click', function(){
                    cart.editCart();
                    cart.goodsNumber();
                    cart.price();
                });

                /**
                 * 初始化：
                 * 1.reset.checkboxAll() //默认全选商品
                 * 2.cart.goodsNumber() //计算己选择商品数量
                 * 3.cart.price()       //计算己选择商品价格
                 */
                reset.checkboxAll();
                cart.goodsNumber();
                cart.price();

            });
        </script>
    </section>

<!-- footer start -->
<style>
    body { margin-bottom: 2.2rem;}
</style>
<footer>
    <div class="footer-box">
        <ul>
            <li class="active">
                <a href="index.html" class="ripple">
                    <p><img src="../img/footer_active_icon_01.png" alt=""></p>
                    <p>首页</p>
                </a>
            </li>
            <li>
                <a href="祼钻查询-白钻.html" class="ripple">
                    <p><img src="../img/footer_icon_02.png" alt=""></p>
                    <p>钻石专区</p>
                </a>
            </li>
            <li>
                <a href="产品分类.html" class="ripple">
                    <p><img src="../img/footer_icon_03.png" alt=""></p>
                    <p>分类</p>
                </a>
            </li>
            <li>
                <a href="购物车.html" class="ripple">
                    <p><img src="../img/footer_icon_04.png" alt=""></p>
                    <p>购物车</p>
                </a>
            </li>
            <li>
                <a href="个人中心.html" class="ripple">
                    <p><img src="../img/footer_icon_05.png" alt=""></p>
                    <p>我的</p>
                </a>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
</footer>
<!-- footer end -->

<!-- Zdy Input UI -->
<script src="../js/zdy-input-ui.js"></script>

</body>
</html>
